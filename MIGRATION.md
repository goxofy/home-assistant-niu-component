# 迁移指南：NIU集成 v1.x 到 v2.0

本指南将帮助您从旧的基于YAML的配置迁移到新的基于UI的配置。

## v2.0中的新功能

- **UI配置**: 不再需要YAML配置
- **更好的性能**: 新的数据协调器架构
- **改进的错误处理**: 更好的错误消息和恢复机制
- **现代集成**: 遵循当前Home Assistant集成标准

## 迁移步骤

### 步骤1：备份您的配置

在开始迁移之前，备份您当前的配置：

1. 复制您当前的`configuration.yaml`文件
2. 记下您当前的传感器配置

### 步骤2：移除旧配置

1. 从您的`configuration.yaml`中移除NIU传感器配置：
   ```yaml
   # 从configuration.yaml中移除此部分
   sensor:
     - platform: niu
       username: your_username
       password: your_password
       scooter_id: 0
       monitored_variables:
         - BatteryCharge
         - CurrentSpeed
         # ... 其他传感器
   ```

### 步骤3：安装新版本

1. **如果使用HACS**: 通过HACS更新集成
2. **如果手动安装**: 用新版本替换`custom_components/niu`文件夹

### 步骤4：重启Home Assistant

重启Home Assistant以加载新集成。

### 步骤5：通过UI配置

1. 进入**设置** → **设备与服务** → **集成**
2. 点击**"+"**按钮
3. 搜索**"NIU Scooter Integration"**
4. 点击它以启动设置向导
5. 输入您的凭据：
   - **用户名/邮箱**: 您的NIU账户用户名或邮箱
   - **密码**: 您的NIU账户密码
   - **滑板车ID**: 您的滑板车ID（第一辆滑板车通常为0）
6. 选择要监控的传感器
7. 点击**"提交"**

### 步骤6：验证迁移

1. 检查所有传感器是否正常工作
2. 验证数据是否正确更新
3. 检查日志中是否有错误

## 多滑板车

如果您有多辆滑板车，您需要多次添加集成：

1. 为每辆滑板车按照设置向导操作
2. 使用相同的凭据但不同的**滑板车ID**值
3. 每辆滑板车将显示为单独的集成

## 故障排除

### 传感器未出现

- 检查您在配置向导中是否选择了传感器
- 进入集成选项以添加更多传感器
- 如有需要，重启Home Assistant

### 连接问题

- 验证您的凭据是否正确
- 检查NIU应用在您的手机上是否正常工作
- 确保您的网络连接稳定

### 数据未更新

- 在**设置** → **设备与服务**中检查集成状态
- 在日志中查找错误消息
- 尝试移除并重新添加集成

## 回滚（如需要）

如果您需要回滚到旧版本：

1. 从**设置** → **设备与服务**中移除新集成
2. 恢复您的旧`configuration.yaml`配置
3. 用旧版本替换`custom_components/niu`文件夹
4. 重启Home Assistant

## 支持

如果您在迁移过程中遇到问题：

1. 查看[GitHub Issues](https://github.com/goxofy/home-assistant-niu-component/issues)
2. 查找类似的迁移问题
3. 创建新问题并详细描述您的问题

## 迁移的好处

- **更容易配置**: 无需编辑YAML
- **更好的性能**: 更高效的数据更新
- **改进的可靠性**: 更好的错误处理和恢复
- **面向未来**: 遵循当前Home Assistant标准
- **更好的用户体验**: 现代UI界面
